{% extends 'base.html' %}
{% load static %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/recipes_detail.css' %}">
{% endblock style %}

{% block content %} 
{% comment %} <p>{{ recipe.id }}</p> {% endcomment %}
{% comment %} 썸네일 이미지 {% endcomment %}
<div class="recipe__main-image__container">
  <img class="recipe__main-image" src="{{ recipe.thumbnail_crop.url}}" alt="{{ recipe.thumbnail_upload }}">
</div>
{% comment %} 레시피 header {% endcomment %}
<div class="recipe__header">
  <div class="recipe__header__status">
    <div class="recipe__header-container__left">
      <h1 class="recipe__title">{{ recipe.title }}</h1>
      <p class="recipe__rate"><i class="bi bi-star-fill"></i> 평균 별점</p>
      <p class="recipe__status">
        <i class="bi bi-eye-fill"></i> {{ recipe.hits }}
        <i class="bi bi-bookmark-heart-fill"></i> {{ recipe.like_users.count }}
      </p>
    </div>
    <div class="recipe__header-container__right">
      <a href="{% url 'accounts:profile' recipe.user.username %}">
        <div class="recipe__header__userinfo">
          <div class="recipe__header__user__container">
            {% if recipe.user.image %}
            <img class="recipe__user__image" src="{{ recipe.user.image }}" alt="{{ recipe.user.username }}의 프로필 이미지">
            {% else %}
            <img class="recipe__user__image" src="{% static 'image/no_image432.png' %}" alt="유저 프로필 사진 없음">
            {% endif %}
          </div>
          <p>{{ recipe.user.username }}</p>
        </div>
      </a>
      <p class="recipe__date">{{ recipe.updated_at|date:'y. m. d' }}</p>
    </div>
  </div>
  {% comment %} 버튼 공간 {% endcomment %}
  <div class="recipe__header__btn-container">
    {% if request.user == recipe.user %}
    <a class="button--color btn-hover__blue me-2" href="{% url 'recipes:update' recipe.pk %}">글 수정</a>
    <button type="button" class="button--color btn-hover__blue me-2" data-bs-toggle="modal" data-bs-target="#recipeDeleteModal">
      글 삭제
    </button>
    {% else %}
    <form action="{% url 'recipes:recipe_like' recipe.pk %}" method="post">
      {% csrf_token %}
      {% if request.user in recipe.like_users.all %}
      <input class="button--color btn-hover__blue" type="submit" value="레시피 팔로우 취소">
      {% else %}
      <input class="button--color btn-hover__blue" type="submit" value="레시피 팔로우">
      {% endif %}
    </form>
    {% endif %}
  </div>
</div>

{% comment %} 레시피에 들어가는 재료 캐루젤  {% endcomment %}
<div>
</div>



{% comment %} 레시피 content (CK editor 작성 결과 화면) {% endcomment %}
<div class="recipe__content">
  {{ recipe.content|safe }}
</div>
{% include 'recipes/detail_delete_modal.html' %}


{% comment %} 마지막 유저 정보, 글 스테이터스 및 글 조작 {% endcomment %}
{% comment %}  
<div class="recipe__footer__info">
  <div class="recipe__footer__info__left">
    <p class="recipe__footer__info__item">좋아요 {{ recipe.like_users.count }}</p>
    <p class="recipe__footer__info__item">댓글 {{ recipe.comment_set.count }}</p>
    <p class="recipe__footer__info__item">조회 {{ recipe.hits }}</p>
  </div>
</div>
{% endcomment %}




{% comment %} 레시피 댓글 {% endcomment %}

{% comment %} 
{% endcomment %}
{% comment %} 댓글 작성란 
{% endcomment %}
{% comment %}  
<form class="recipe__comment__input-area" action="{% url 'recipes:comment_create' recipe.pk %}" method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <div class="recipe__comment__input-area__input--text">
    {{ comment_form.content }}
  </div>
  <div class="recipe__comment__input-area__input--image">
    <label for="input-commentimage">
      <i class="bi bi-camera-fill"></i>
    </label>
    {{ comment_image_form.image }}
  </div>
  <input class="recipe__comment__input-area__input--submit" type="submit" value="작성">
</form>
{% endcomment %}
{% comment %} 댓글 표시 {% endcomment %}

{% comment %} 
<div class="recipe__comment__list" id="comment-start">
  {% for comment in comments %}
  <div class="recipe__comment__item">
    <div class="recipe__header__image__container">
      {% if recipe.user.image %}
      <img class="recipe__header__image" src="{{ comment.user.image}}" alt="{{ comment.user.username }}의 프로필 이미지">
      {% else %}
      <img class="recipe__header__image" src="{% static 'image/no_image432.png' %}" alt="유저 프로필 사진 없음">
      {% endif %}
    </div>
    <form action="{% url 'recipes:comment_delete' recipe.pk comment.pk %}" method='POST'>
      {% csrf_token %}
      <p>리뷰 내용 : {{ comment.content }}</p>
      {% for comment_img in comment.commentimage_set.all %}
        {% if comment_img.image %}
          <img src="{{ comment_img.image.url }}" alt="">
          {% endif %}
      {% endfor %}
        <input type="submit" value='삭제'>
    </form>
    <form action="{% url 'recipes:comment_like' recipe.pk comment.pk %}">
      {% csrf_token %}
      {% if request.user in comment.like_user.all %}
        <input type="submit" value='종아요취소'>
      {% else %}
        <input type="submit" value='좋아요'>
      {% endif %}
    </form>
    <form action="{% url 'recipes:comment_update' recipe.pk comment.pk %}" method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      {{ comment_form.as_p }}
      {{ comment_image_form.as_p }}
      <input type="submit" value="수정">
    </form>
    <div>
      <p>{{ comment.user.username }}</p>
      <p>{{ comment.user.content }}</p>
      <p>{{ comment.content }}</p>
    </div>
  </div>
  {% endfor %}
</div> 
{% endcomment %}
{% endblock content %}